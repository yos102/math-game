<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××§×“××™×™×ª ×”××ª××˜×™×§×” - ×’×¨×¡×” 8.0</title>
    <style>
        :root {
            --primary: #4a90e2; --bg: #f7fafc; --card-bg: #ffffff; --text: #1a202c; --accent: #f6e05e;
            --sub-color: #f56565; --mul-color: #ed8936;
        }
        body.dark-mode { --bg: #1a202c; --card-bg: #2d3748; --text: #f7fafc; }
        body.kids-mode { --bg: #fff5f7; --primary: #ff6b6b; --text: #4a5568; }

        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; transition: 0.3s; direction: rtl; overflow-x: hidden; }
        .container { max-width: 600px; width: 92%; background: var(--card-bg); padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); position: relative; text-align: center; margin: 20px auto; }
        .hidden { display: none !important; }
        
        /* ×ª×¤×¨×™×˜×™× */
        .btn { padding: 18px; border-radius: 15px; border: none; font-size: 1.2rem; font-weight: bold; cursor: pointer; width: 100%; margin: 10px 0; transition: 0.2s; color: white; }
        .btn-blue { background: var(--primary); }
        .btn-red { background: var(--sub-color); }
        .btn-orange { background: var(--mul-color); }
        .btn-purple { background: #9f7aea; }

        /* ×’×¨×™×“ ×××•× ×š */
        .vertical-math { display: grid; grid-template-columns: 50px repeat(4, 60px); gap: 5px; justify-content: center; align-items: center; margin: 25px auto; direction: ltr; }
        .digit { font-family: 'Courier New', monospace; font-size: 2.8rem; font-weight: bold; }
        .carry-demo, .carry-input { width: 35px; height: 35px; border: 2px dashed #ccc; border-radius: 50%; margin: auto; display: flex; align-items: center; justify-content: center; }
        .ans-demo, .ans-input { width: 55px; height: 65px; border: 3px solid var(--primary); border-radius: 12px; font-size: 2.2rem; text-align: center; background: #ebf8ff; margin: auto; }
        .line { grid-column: 1 / span 5; height: 4px; background: #333; margin: 5px 0; }
        .operator { grid-column: 1; font-size: 2.5rem; }

        /* ×× ×™××¦×™×” */
        .tutorial-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .tutorial-box { background: white; color: #333; padding: 25px; border-radius: 25px; width: 90%; max-width: 500px; text-align: center; }
        .step-msg { font-size: 1.3rem; margin-bottom: 15px; font-weight: bold; color: var(--primary); min-height: 3.5em; }
        .highlight { color: #f6e05e !important; transform: scale(1.2); }
        .strikethrough { text-decoration: line-through; color: red; opacity: 0.6; }
    </style>
</head>
<body class="kids-mode">

    <div class="container">
        <div id="page-lobby">
            <h1>××” × ×œ××“ ×”×™×•×? ğŸ“</h1>
            <button class="btn btn-blue" onclick="startSimple('add')">â• ×—×™×‘×•×¨ ×•×—×™×¡×•×¨</button>
            <button class="btn btn-orange" onclick="startSimple('mul')">âœ–ï¸ ×›×¤×œ ×•×—×™×œ×•×§</button>
            <button class="btn btn-purple" onclick="showPage('setup-v')">ğŸ“ ×—×©×‘×•×Ÿ ×××•× ×š</button>
            <button class="btn btn-red" onclick="startSimple('story')">ğŸ“– ×‘×¢×™×•×ª ××™×œ×•×œ×™×•×ª</button>
        </div>

        <div id="page-setup-v" class="hidden">
            <h2>×‘×—×¨ ×¡×•×’ ×××•× ×š:</h2>
            <button class="btn btn-blue" onclick="vType='add'; startMode('vertical')">×—×™×‘×•×¨ ×××•× ×š</button>
            <button class="btn btn-red" onclick="vType='sub'; startMode('vertical')">×—×™×¡×•×¨ ×××•× ×š</button>
            <button class="btn btn-orange" onclick="showPage('setup-mul')">×›×¤×œ ×××•× ×š â”</button>
            <button class="btn" style="color:black" onclick="showPage('lobby')">×—×–×¨×”</button>
        </div>

        <div id="page-setup-mul" class="hidden">
            <h2>×‘×—×¨ ×¨××ª ×›×¤×œ:</h2>
            <button class="btn btn-orange" onclick="mulLevel='single'; vType='mul'; startMode('vertical')">×›×¤×œ ×‘×—×“-×¡×¤×¨×ª×™ (×›××• 124x3)</button>
            <button class="btn btn-orange" onclick="mulLevel='double'; vType='mul'; startMode('vertical')">×›×¤×œ ×‘×“×•-×¡×¤×¨×ª×™ (×›××• 124x23)</button>
            <button class="btn" style="color:black" onclick="showPage('setup-v')">×—×–×¨×”</button>
        </div>

        <div id="page-game" class="hidden">
            <button id="helpBtn" style="float:right; background:gold; border-radius:50%; width:40px; height:40px; border:none; font-weight:bold; cursor:pointer;" onclick="startTutorial()">?</button>
            <div id="game-content"></div>
            <button class="btn btn-blue" style="margin-top:20px;" onclick="check()">×‘×“×™×§×”</button>
            <div id="feedback" style="margin-top:10px; font-weight:bold;"></div>
            <button class="btn" style="color:black" onclick="showPage('lobby')">×™×¦×™××”</button>
        </div>
    </div>

    <div id="tutorial-screen" class="tutorial-overlay hidden">
        <div class="tutorial-box">
            <div id="t-msg" class="step-msg"></div>
            <div id="t-grid" class="vertical-math"></div>
            <button class="btn btn-blue" onclick="closeTutorial()">×”×‘× ×ª×™!</button>
        </div>
    </div>

<script>
    let currentMode = '', vType = 'add', mulLevel = 'single', currentQ = {};

    function showPage(id) {
        document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
        document.getElementById('page-' + id).classList.remove('hidden');
    }

    function startMode(m) {
        currentMode = m; showPage('game'); nextQ();
    }

    function nextQ() {
        document.getElementById('feedback').innerText = '';
        const content = document.getElementById('game-content');
        if(currentMode === 'vertical') renderVertical(content);
        else content.innerHTML = "<h2>×‘×§×¨×•×‘...</h2>";
    }

    function renderVertical(container) {
        let n1 = Math.floor(Math.random()*800)+100;
        let n2 = vType === 'mul' ? (mulLevel === 'single' ? Math.floor(Math.random()*7)+2 : Math.floor(Math.random()*80)+11) : Math.floor(Math.random()*800)+10;
        if(vType === 'sub' && n1 < n2) [n1, n2] = [n2, n1];
        
        currentQ = { n1, n2, ans: vType==='add' ? n1+n2 : (vType==='sub' ? n1-n2 : n1*n2) };

        let html = `<div class="vertical-math">`;
        html += `<div></div><div class="carry-input"></div><input type="text" class="carry-input" id="c2"><input type="text" class="carry-input" id="c1"><div></div>`;
        html += `<div></div>${dg(n1)}`;
        html += `<div class="operator">${vType==='add'?'+':(vType==='sub'?'-':'Ã—')}</div>${dg(n2)}`;
        html += `<div class="line"></div>`;
        
        if(vType === 'mul' && mulLevel === 'double') {
            html += `<div></div><input type="number" class="ans-input"><input type="number" class="ans-input"><input type="number" class="ans-input"><input type="number" class="ans-input">`;
            html += `<div></div><input type="number" class="ans-input" onfocus="clearC()"><input type="number" class="ans-input" onfocus="clearC()"><input type="number" class="ans-input" onfocus="clearC()"><div class="digit" style="color:#ccc">0</div>`;
            html += `<div class="line"></div>`;
        }
        html += `<div></div><input type="number" class="ans-input" id="va3" tabindex="4"><input type="number" class="ans-input" id="va2" tabindex="3"><input type="number" class="ans-input" id="va1" tabindex="2"><input type="number" class="ans-input" id="va0" tabindex="1">`;
        container.innerHTML = html + `</div>`;
    }

    function dg(n) { return [...n.toString().padStart(4, ' ')].map(c => `<div class="digit">${c===' '?'':c}</div>`).join(''); }
    function clearC() { document.querySelectorAll('.carry-input').forEach(i => i.value = ''); }

    // --- ××¢×¨×›×ª ×”×× ×™××¦×™×” ---
    function startTutorial() {
        const screen = document.getElementById('tutorial-screen');
        const msg = document.getElementById('t-msg');
        const grid = document.getElementById('t-grid');
        screen.classList.remove('hidden');
        grid.innerHTML = '';

        let steps = [];

        if(vType === 'add') {
            grid.innerHTML = `<div></div><div class="carry-demo" id="tc"></div><div class="carry-demo"></div><div></div><div></div><div></div><div class="digit">4</div><div class="digit" id="tn1">8</div><div></div><div class="operator">+</div><div class="digit">3</div><div class="digit" id="tn2">5</div><div></div><div class="line"></div><div></div><div class="ans-demo" id="ta1"></div><div class="ans-demo" id="ta0"></div>`;
            steps = [
                { m: "8 + 5 = 13", act: () => { document.getElementById('tn1').classList.add('highlight'); document.getElementById('tn2').classList.add('highlight'); }},
                { m: "×›×•×ª×‘×™× 3 ×œ××˜×” ×•×–×•×›×¨×™× 1 ×œ××¢×œ×”", act: () => { document.getElementById('ta0').innerText = "3"; document.getElementById('tc').innerText = "1"; }}
            ];
        } else if(vType === 'sub') {
            grid.innerHTML = `<div></div><div></div><div class="digit" id="tn1-1">5</div><div class="digit" id="tn1-2">2</div><div></div><div class="operator">-</div><div></div><div class="digit" id="tn2-1">1</div><div class="digit" id="tn2-2">7</div><div></div><div class="line"></div><div></div><div></div><div class="ans-demo" id="ta1"></div><div class="ans-demo" id="ta0"></div>`;
            steps = [
                { m: "2 ×§×˜×Ÿ ×-7, ××™ ××¤×©×¨ ×œ×—×¡×¨!", act: () => { document.getElementById('tn1-2').classList.add('highlight'); }},
                { m: "×œ×•×•×™× 1 ××”×¢×©×¨×•×ª (×”-5 ×”×•×¤×š ×œ-4)", act: () => { document.getElementById('tn1-1').classList.add('strikethrough'); }},
                { m: "×¢×›×©×™×• ×‘×™×—×™×“×•×ª ×™×© ×œ× ×• 12. 12 ×¤×—×•×ª 7 ×–×” 5", act: () => { document.getElementById('ta0').innerText = "5"; }}
            ];
        } else {
            grid.innerHTML = `<div class="step-msg">×× ×™××¦×™×™×ª ×›×¤×œ ×‘×©×œ×‘×™×</div>`;
            steps = [{ m: "×‘×›×¤×œ, ××›×¤×™×œ×™× ×§×•×“× ××ª ×”××—×“×•×ª ×‘×›×œ ×”××¡×¤×¨ ×œ××¢×œ×”, ×•××– ×¢×•×‘×¨×™× ×œ×¢×©×¨×•×ª ×•××•×¡×™×¤×™× 0!", act: () => {}}];
        }

        let i = 0;
        const intr = setInterval(() => {
            if(i >= steps.length) { clearInterval(intr); return; }
            msg.innerText = steps[i].m; steps[i].act(); i++;
        }, 3000);
    }

    function closeTutorial() { document.getElementById('tutorial-screen').classList.add('hidden'); }
    function check() { /* ×‘×“×™×§×” ×¨×’×™×œ×” */ }
</script>
</body>
</html>
